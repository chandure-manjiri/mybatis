<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mybatis.com.mybatis.Repository.TeacherRepository" >

    <resultMap id="TeacherResultMap" type="mybatis.com.mybatis.Entity.TeacherEntity" >
        <id column="id" property="id"/>
        <result column="first_name" property="firstName"/>
        <result column="last_name" property="lastName"/>
        <result column="gender" property="gender"/>
        <result column="age" property="age"/>
        <result column="phone_number" property="phoneNumber"/>
        <result column="email" property="email"/>
        <collection property="subjectEntities" ofType="mybatis.com.mybatis.Entity.SubjectEntity"
                    column="id" select="selectSubjectByTeacherId"/>
    </resultMap>

<!--    <resultMap id="TeacherResultMapNoSubject" type="mybatis.com.mybatis.Entity.TeacherEntity" >-->
<!--        <id column="id" property="id"/>-->
<!--        <result column="first_name" property="firstName"/>-->
<!--        <result column="last_name" property="lastName"/>-->
<!--        <result column="gender" property="gender"/>-->
<!--        <result column="age" property="age"/>-->
<!--        <result column="phone_number" property="phoneNumber"/>-->
<!--        <result column="email" property="email"/>-->
<!--    </resultMap>-->

    <resultMap id = "SubjectResultMap"
               type = "mybatis.com.mybatis.Entity.SubjectEntity">
        <id property = "id" column = "id"/>
        <result property = "name" column = "name"/>
<!--        <result property="teacherId" column="teacher_id"/>-->
    </resultMap>

    <select id="findAllTeachers" resultMap="TeacherResultMap"
            resultType="mybatis.com.mybatis.Entity.TeacherEntity">
        select id,first_name, last_name, gender, age, phone_number, email
        from teacher
    </select>

    <select id="findTeacherById" resultMap="TeacherResultMap" parameterType="java.lang.Integer"
            resultType="mybatis.com.mybatis.Entity.TeacherEntity">
        select id,first_name, last_name, gender, age, phone_number, email
        from teacher where id = #{id}
    </select>
    
    <select id="selectSubjectByTeacherId" parameterType="java.lang.Integer"
            resultType="mybatis.com.mybatis.Entity.SubjectEntity"
            resultMap="SubjectResultMap">
        select subject.id, subject.name , subject.teacher_id from subject where subject.teacher_id = #{id}
    </select>

    <insert id="insertTeacher" keyProperty="id" useGeneratedKeys="true" parameterType="mybatis.com.mybatis.Entity.TeacherEntity" keyColumn="id">
        insert into teacher (first_name, last_name, gender, age, phone_number, email)
        values (#{firstName},#{lastName},#{gender},#{age}, #{phoneNumber}, #{email})
   </insert>
</mapper>